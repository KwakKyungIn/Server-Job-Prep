# 🧠 운영체제 개요 (OSTEP Chapter 5)

운영체제는 컴퓨터 자원을 사용자와 응용 프로그램이 쉽게, 안전하게, 효율적으로 사용할 수 있도록 **가상화(virtualization)** 기법을 제공한다. 이 장에서는 운영체제가 하는 주요 역할 4가지와 그 철학을 다룬다.

---

## 📌 운영체제의 핵심 역할

| 역할 | 설명 |
|------|------|
| 🧠 CPU 가상화 | 하나의 CPU를 여러 개의 가상 CPU처럼 보이게 만들어 여러 프로그램이 동시에 실행되는 것처럼 동작 |
| 🧠 메모리 가상화 | 각 프로그램에 독립적인 가상 주소 공간을 제공 |
| 🔁 병행성 (Concurrency) | 여러 작업을 동시에 처리하며 생기는 문제 해결 |
| 💾 영속성 (Persistence) | 전원이 꺼져도 데이터가 보존되도록 디스크/파일 시스템 제공 |

---

## 5.1 CPU 가상화

### 핵심 질문  
> 자원을 어떻게 가상화하는가?

- 프로그램은 명령어를 순차적으로 실행
- 운영체제는 하나의 물리 CPU를 여러 개의 **가상 CPU**처럼 만들어 여러 프로그램을 동시 실행하는 것처럼 보이게 한다
- → **CPU 스케줄링**, **타이머 인터럽트** 등을 사용

### 예제 코드 (`cpu.c`)

```c
while (1) {
    Spin(1);            // 1초 대기
    printf("%s\n", str);
}
```

```bash
./cpu A & ./cpu B & ./cpu C & ./cpu D &
```

> CPU 하나로도 여러 프로세스가 동시에 실행되는 것처럼 보임 = CPU 가상화

---

## 5.2 메모리 가상화

### 핵심 질문  
> 물리 메모리를 어떻게 가상화할 수 있는가?

- 운영체제는 각 프로세스에 **독립적인 주소 공간**을 제공
- 실제로는 물리 메모리를 공유하지만, 각자 자기 메모리를 사용하는 것처럼 동작

### 예제 코드 (`mem.c`)

```c
int *p = malloc(sizeof(int));
*p = 0;
while (1) {
    *p += 1;
    printf("p: %d\n", *p);
}
```

> 동일한 코드 실행 시 같은 주소(예: 0x200000) 출력 → 실제로는 다른 물리 메모리 사용

---

## 5.3 병행성 (Concurrency)

### 핵심 질문  
> 올바르게 동작하는 병행 프로그램은 어떻게 작성할 수 있는가?

- 멀티스레드 프로그램은 동시에 같은 변수에 접근할 수 있으므로, **경쟁 조건(Race Condition)** 이 발생
- 올바른 병행 처리를 위해 **락(mutex)** 등 동기화 기법이 필요함

### 예제 코드 (`thread.c`)

```c
pthread_create(&p1, NULL, worker, NULL);
pthread_create(&p2, NULL, worker, NULL);
```

> `counter++`가 원자적이지 않기 때문에 결과가 다르게 나올 수 있음

---

## 5.4 영속성 (Persistence)

### 핵심 질문  
> 데이터를 영속적으로 저장하려면 어떻게 해야 하는가?

- 메모리는 휘발성이므로 **디스크(I/O 장치)**에 데이터를 저장
- 운영체제는 **파일 시스템(file system)** 을 통해 데이터 저장/조회 가능하게 함
- `open()`, `write()`, `close()` 같은 시스템 콜 제공

---

## 5.5 운영체제 설계 목표

| 목표 | 설명 |
|------|------|
| 추상화 (Abstraction) | 복잡한 하드웨어를 간단한 개념으로 감싸서 사용 편의성 제공 |
| 성능 (Performance) | 오버헤드를 줄이고, 효율적인 자원 사용 |
| 보호 (Protection) | 프로그램 간 메모리 침범 방지 |
| 신뢰성 (Reliability) | 운영체제 오류가 전체 시스템 오류로 이어지지 않도록 함 |

---

## 5.6 역사 요약

- 운영체제는 초기엔 단순한 함수 모음(library)이었음
- → 시스템 콜, 프로세스, 메모리 보호, 병행성 처리 등 기능이 추가되며 현대 운영체제로 발전
- 대표적 역사:
  - **UNIX**: 가장 큰 영향력을 미친 운영체제
  - **Linux**: 오픈소스 Unix 호환 커널 (Linus Torvalds 제작)
  - **Windows NT**: 보안, 멀티태스킹 도입

---

## 5.7 요약

운영체제는 크게 다음 4가지 기능을 중심으로 설계된다:

- CPU 가상화
- 메모리 가상화
- 병행성
- 영속성

이러한 기능들은 시스템의 사용성, 성능, 보호, 신뢰성을 모두 만족시키기 위해 존재한다.

---

> 📚 출처: 『운영체제: 아주 쉬운 세 가지 이야기 (OSTEP)』
